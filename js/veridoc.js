!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}([function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=!0,o=!0;function a(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}e.exports={extractVersion:a,wrapPeerConnectionEvent:function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){n(r(e))};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=a(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=a(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=a(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=a(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(82));t.default=function(e){return"string"==typeof e&&n.default.test(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2));for(var i=[],o=0;o<256;++o)i.push((o+256).toString(16).substr(1));t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!(0,n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},function(e,t,r){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";e.exports={getDocTypeIndex:function(e){var t=void 0;switch(e){case"id":t=1;break;case"driverLic":t=17;break;case"vehCert":t=20;break;case"sim":t=32;break;case"sim2":t=40;break;case"passport":t=42;break;default:t=28}return t},getDocTypeString:function(e){var t=void 0;switch(e){case 1:t="id";break;case 17:t="driverLic";break;case 20:t="vehCert";break;case 32:t="sim";break;case 40:t="sim2";break;case 42:t="passport";break;default:t="mrz"}return t}}},function(e,t,r){"use strict";var n=Object.freeze({INCONSISTENT_BD_AND_IIN:0,GENDER_UNSPECIFIED_IN_IIN:1,DOCUMENT_EXPIRED:2,INCONSISTENT_TRANSLITERATION:3});e.exports={RecognitionWarning:n,getRecognitionWarning:function(e){var t=void 0;switch(e){case 0:t=n.INCONSISTENT_BD_AND_IIN;break;case 1:t=n.GENDER_UNSPECIFIED_IN_IIN;break;case 2:t=n.DOCUMENT_EXPIRED;break;default:t=n.INCONSISTENT_TRANSLITERATION}return t}}},,,,,function(e,t,r){"use strict";(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},r.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=u})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},"object"===t(e)&&(e.exports=r)}).call(this,r(4)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2));t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,r){function o(e,o,a,s){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof o&&(o=(0,i.default)(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+e.length);if(c.set(o),c.set(e,o.length),(c=r(c))[6]=15&c[6]|t,c[8]=63&c[8]|128,a){s=s||0;for(var d=0;d<16;++d)a[s+d]=c[d];return a}return(0,n.default)(c)}try{o.name=e}catch(e){}return o.DNS=a,o.URL=s,o};var n=o(r(3)),i=o(r(12));function o(e){return e&&e.__esModule?e:{default:e}}var a=t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s=t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8"},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)};var i=new Uint8Array(16)},function(e,t,r){"use strict";var n=Object.freeze({front_side:"ЛИЦЕВАЯ СТОРОНА",back_side:"ОБРАТНАЯ СТОРОНА",show_back_id:"Наведите камеру на <b>оборотную</b> сторону удостоверения личности",show_front_id:"Наведите камеру на <b>лицевую</b> сторону удостоверения личности",show_back_doc:"Наведите камеру на <b>оборотную</b> сторону документа",show_front_doc:"Наведите камеру на <b>лицевую</b> сторону документа",error_show_front:"Вам нужно показать <b>лицевую</b> сторону документа",recognition_error_repeat:"Ошибка распознавания. Убедитесь, что данные на изображении видны и отсутствуют блики",error_two_side_check:"Распознанные данные содержат ошибки. Повторите все сначала!",error_show_back:"Вам нужно показать <b>оборотную</b> сторону документа!",recognition_succeeded:" ",retake:"ПЕРЕСНЯТЬ",blurry_error:"Изображение слишком размытое. Убедитесь, что данные на изображении видны отчетливо",glare_error:"Изображение документа содержит блики. Убедитесь, что данные видны отчетливо",id_has_no_iin:"Ошибка распознавания. Удостовертесь, что документ содержит ИИН",undefined_error:"Ошибка распознавания. Убедитесь, что данные на изображении видны и отсутствуют блики",document_not_found_error:"Документ не был найден. Убедитесь, что данные на изображении видны, отсутствуют блики и нет засветов",point_camera:"Наведите камеру на",document:"документ",passport:"паспорт",identity_document:"удостоверение личности",mrz_document:"МРЗ зону",simcard:"симкарту",retry_btn:"РАСПОЗНАТЬ ЗАНОВО"});e.exports={strings:n}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(11),o=r(0);e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),o=i.parseCandidate(e.candidate),a=Object.assign(r,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===(void 0===e?"undefined":n(e))&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),i=t.revokeObjectURL.bind(t),a=new Map,s=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++s;return a.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){i(e),a.delete(e)};var c=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return c.get.apply(this)},set:function(e){return this.srcObject=a.get(e)||null,c.set.apply(this,[e])}});var d=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=a.get(arguments[1])||null),d.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=o.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,function(e){var t=i.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=i.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var e,n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),o=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(n),a=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var o=i.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],n);e=0===o&&0===a?Number.POSITIVE_INFINITY:0===o||0===a?Math.max(o,a):Math.min(o,a);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return e}}),this._sctp=s}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},o.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(0);e.exports={shimLocalStreamsAPI:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}}))},shimCallbacksAPI:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var c=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,n.push(a)):n.push(e.iceServers[o])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),void 0!==e.offerToReceiveAudio&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(0),o=i.log;e.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,a=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,i,a){var c=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i=e[r]="object"===n(e[r])?e[r]:{ideal:e[r]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(r),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[r]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof i.ideal?o[r]={min:i.ideal,max:i.ideal}:o[r]=i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=c(e.audio)),e.video&&(e.video=c(e.video)),o("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,i,function(e){a(s(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){c(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var d=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(s(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var p=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),p(e.audio,"autoGainControl","mozAutoGainControl"),p(e.audio,"noiseSuppression","mozNoiseSuppression")),l(e)},a&&a.prototype.getSettings){var f=a.prototype.getSettings;a.prototype.getSettings=function(){var e=f.apply(this,arguments);return p(e,"mozAutoGainControl","autoGainControl"),p(e,"mozNoiseSuppression","noiseSuppression"),e}}if(a&&a.prototype.applyConstraints){var h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),p(e,"autoGainControl","mozAutoGainControl"),p(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}r.getUserMedia=function(e,n,o){if(t.version<44)return c(e,n,o);i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(n,o)}}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(0);e.exports={shimGetUserMedia:r(58),shimOnTrack:function(e){"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}}),"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===(void 0===e?"undefined":n(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"===(void 0===e?"undefined":n(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],o=0;o<r.iceServers.length;o++){var a=r.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(r.iceServers[o])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(r,n)}}},shimSenderGetStats:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),i.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;i.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}}},function(e,t,r){"use strict";e.exports=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,r){"use strict";var n=r(11);function i(e,t,r,i,o){var a=n.writeRtpDescription(e.kind,t);if(a+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),a}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function a(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function s(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var u=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},u.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},u.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},u.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},u.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var d=n.writeCandidate(s);a.candidate=Object.assign(a.candidate,n.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var u=n.getMediaSections(i._localDescription.sdp);u[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+u.join("");var p=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),p&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,r,i){var a=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},u.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var s=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,d=a.iceTransport,u=a.dtlsTransport,p=a.localCapabilities,l=a.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var f=n.getIceParameters(e,r),h=n.getDtlsParameters(e,r);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===d.state&&d.start(c,f,s?"controlling":"controlled"),"new"===u.state&&u.start(h));var v=o(p,l);i._transceive(a,v.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var u={};o.remoteStreams.forEach(function(e){u[e.id]=e});var p=[],l=n.splitSections(i.sdp),f=l.shift(),h=n.matchPrefix(f,"a=ice-lite").length>0,v=n.matchPrefix(f,"a=group:BUNDLE ").length>0;o.usingBundle=v;var m=n.matchPrefix(f,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!m&&m.substr(14).split(" ").indexOf("trickle")>=0,l.forEach(function(a,c){var d=n.splitLines(a),l=n.getKind(a),m=n.isRejected(a)&&0===n.matchPrefix(a,"a=bundle-only").length,g=d[0].substr(2).split(" ")[2],y=n.getDirection(a,f),C=n.parseMsid(a),b=n.getMid(a)||n.generateIdentifier();if(m||"application"===l&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[c]={mid:b,kind:l,protocol:g,rejected:!0};else{var T,S,w,R,P,E,_,k,x;!m&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(l,!0));var O,I,M=n.parseRtpParameters(a);m||(O=n.getIceParameters(a,f),(I=n.getDtlsParameters(a,f)).role="client"),_=n.parseRtpEncodingParameters(a);var D=n.parseRtcpParameters(a),j=n.matchPrefix(a,"a=end-of-candidates",f).length>0,L=n.matchPrefix(a,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!m&&v&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||m)"answer"!==i.type||m||(S=(T=o.transceivers[c]).iceGatherer,w=T.iceTransport,R=T.dtlsTransport,P=T.rtpReceiver,E=T.sendEncodingParameters,k=T.localCapabilities,o.transceivers[c].recvEncodingParameters=_,o.transceivers[c].remoteCapabilities=M,o.transceivers[c].rtcpParameters=D,L.length&&"new"===w.state&&(!h&&!j||v&&0!==c?L.forEach(function(e){s(T.iceTransport,e)}):w.setRemoteCandidates(L)),v&&0!==c||("new"===w.state&&w.start(S,O,"controlling"),"new"===R.state&&R.start(I)),o._transceive(T,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!P||"sendrecv"!==y&&"sendonly"!==y?delete T.rtpReceiver:(x=P.track,C?(u[C.stream]||(u[C.stream]=new e.MediaStream),r(x,u[C.stream]),p.push([x,P,u[C.stream]])):(u.default||(u.default=new e.MediaStream),r(x,u.default),p.push([x,P,u.default]))));else{(T=o.transceivers[c]||o._createTransceiver(l)).mid=b,T.iceGatherer||(T.iceGatherer=o._createIceGatherer(c,v)),L.length&&"new"===T.iceTransport.state&&(!j||v&&0!==c?L.forEach(function(e){s(T.iceTransport,e)}):T.iceTransport.setRemoteCandidates(L)),k=e.RTCRtpReceiver.getCapabilities(l),t<15019&&(k.codecs=k.codecs.filter(function(e){return"rtx"!==e.name})),E=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,A=!1;if("sendrecv"===y||"sendonly"===y){if(A=!T.rtpReceiver,P=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,l),A)x=P.track,C&&"-"===C.stream||(C?(u[C.stream]||(u[C.stream]=new e.MediaStream,Object.defineProperty(u[C.stream],"id",{get:function(){return C.stream}})),Object.defineProperty(x,"id",{get:function(){return C.track}}),N=u[C.stream]):(u.default||(u.default=new e.MediaStream),N=u.default)),N&&(r(x,N),T.associatedRemoteMediaStreams.push(N)),p.push([x,P,N])}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===T.rtpReceiver.track.id});r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),T.associatedRemoteMediaStreams=[]);T.localCapabilities=k,T.remoteCapabilities=M,T.rtpReceiver=P,T.rtcpParameters=D,T.sendEncodingParameters=E,T.recvEncodingParameters=_,o._transceive(o.transceivers[c],!1,A)}}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(u).forEach(function(t){var r=u[t];if(r.getTracks().length){if(-1===o.remoteStreams.indexOf(r)){o.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){o._dispatchEvent("addstream",n)})}p.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&d(o,t,n,[r])})}}),p.forEach(function(e){e[2]||d(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},u.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=r.transceivers.filter(function(e){return"audio"===e.kind}).length,a=r.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(r._createTransceiver("audio"),o--),a>0&&(r._createTransceiver("video"),a--);var d=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=d,i.sendEncodingParameters=u}),"max-compat"!==r._config.bundlePolicy&&(d+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(u)},u.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var a=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(a+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(d)},u.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<r.transceivers.length;d++)if(r.transceivers[d].mid===e.sdpMid){a=d;break}var u=r.transceivers[a];if(!u)return o(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var p=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===p.protocol&&(0===p.port||9===p.port))return i();if(p.component&&1!==p.component)return i();if((0===a||a>0&&u.iceTransport!==r.transceivers[0].iceTransport)&&!s(u.iceTransport,p))return o(c("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(p.type?l:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);i()})},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[r]),t.set(r,e[r])}),t})}}});var p=["createOffer","createAnswer"];return p.forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(p=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),u}},function(e,t,r){"use strict";var n=r(0);e.exports=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},function(e,t,r){"use strict";var n=r(0),i=r(62),o=r(61);e.exports={shimGetUserMedia:r(60),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(0),o=i.log;e.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,a=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[o("min",r)]=i.ideal,t.optional.push(a),(a={})[o("max",r)]=i.ideal,t.optional.push(a)):(a[o("",r)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var d,u=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===c.exact||"environment"===c.ideal?d=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return d.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==d.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=a(e.video),o("chrome: "+JSON.stringify(e)),i(e)});e.video=a(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){s(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(c(e))})})};var d=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return s(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}else r.mediaDevices.getUserMedia=function(e){return d(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(0),o=i.log;function a(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&function e(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(i){i.endsWith("Id")?e(t,t.get(r[i]),n):i.endsWith("Ids")&&r[i].forEach(function(r){e(t,t.get(r),n)})}))}(e,r,i)})}),i}e.exports={shimGetUserMedia:r(64),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||i.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],o.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],a.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return a(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),i.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return a(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(t?n=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(r?n=!0:r=e),e.track===i}),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"===(void 0===e?"undefined":n(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());r._streams[t.id]=i,r._reverseStreams[i.id]=t,t=i}n.apply(r,[t])};var o=e.RTCPeerConnection.prototype.removeStream;function a(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var o=n._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);n._streams[r.id]=a,n._reverseStreams[a.id]=r,n.addStream(a)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=a(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return a(e,t)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,r){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,n.push(a)):n.push(e.iceServers[o])}e.iceServers=n}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof arguments[0]))return a.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return a.apply(this,[function(e){i[1](s(o(e)))},arguments[0]])}return new Promise(function(e,t){a.apply(n,[function(t){e(s(o(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===n(arguments[0])){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var s=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},function(e,t,r){"use strict";var n=r(0);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=n.log,c=n.detectBrowser(i),d=r(65)||null,u=r(63)||null,p=r(59)||null,l=r(57)||null,f=r(56)||null,h={browserDetails:c,commonShim:f,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),h;s("adapter.js shimming chrome."),h.browserShim=d,f.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),d.shimSenderReceiverGetStats(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"firefox":if(!p||!p.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),h;s("adapter.js shimming firefox."),h.browserShim=p,f.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimSourceObject(i),p.shimPeerConnection(i),p.shimOnTrack(i),p.shimRemoveStream(i),p.shimSenderGetStats(i),p.shimReceiverGetStats(i),p.shimRTCDataChannel(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"edge":if(!u||!u.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),h;s("adapter.js shimming edge."),h.browserShim=u,f.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimPeerConnection(i),u.shimReplaceTrack(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"safari":if(!l||!o.shimSafari)return s("Safari shim is not included in this adapter release."),h;s("adapter.js shimming safari."),h.browserShim=l,f.shimCreateObjectURL(i),l.shimRTCIceServerUrls(i),l.shimCallbacksAPI(i),l.shimLocalStreamsAPI(i),l.shimRemoteStreamsAPI(i),l.shimTrackEventTransceiver(i),l.shimGetUserMedia(i),l.shimCreateOfferLegacy(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return h}},function(e,t,r){"use strict";var n,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":i(window))&&(n=window)}e.exports=n},function(e,t,r){"use strict";(function(t){var n=r(66);e.exports=n({window:t.window})}).call(this,r(67))},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=document.createElement("p"),this.defaultCssText="margin: 0px 12%; position:absolute; text-align:center; width:76%; line-height: 1.2; padding: 0px; background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.7) 5%, rgba(0, 0, 0, 0.7) 95%, rgba(0,0,0,0) 100%); color: white; font-family: Arial, Helvetica, sans-serif;",this.view.style.cssText=this.defaultCssText,this.view.innerHTML=""}return n(e,[{key:"setText",value:function(e){this.view.innerHTML=e}},{key:"setVisibility",value:function(e){this.view.style.display=e?"block":"none"}},{key:"getNode",value:function(){return this.view}},{key:"updatePosition",value:function(e){this.view.style.cssText=e>800?this.defaultCssText+"font-size: 28px; bottom: 70px;":e>500?this.defaultCssText+"font-size: 22px; bottom: 55px;":this.defaultCssText+"font-size: 13px; bottom: 35px;"}}]),e}();e.exports={StatusTextView:i}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){if("undefined"!=typeof window){var e=window.navigator.userAgent.match(/Edge\/(\d{2})\./),t=!!e&&parseInt(e[1],10)>=16;if("objectFit"in document.documentElement.style!=0&&!t)return void(window.objectFitPolyfill=function(){return!1});var r=function(e,t,r){var n,i,o,a,s;if((r=r.split(" ")).length<2&&(r[1]=r[0]),"x"===e)n=r[0],i=r[1],o="left",a="right",s=t.clientWidth;else{if("y"!==e)return;n=r[1],i=r[0],o="top",a="bottom",s=t.clientHeight}return n===o||i===o?void(t.style[o]="0"):n===a||i===a?void(t.style[a]="0"):"center"===n||"50%"===n?(t.style[o]="50%",void(t.style["margin-"+o]=s/-2+"px")):n.indexOf("%")>=0?void((n=parseInt(n))<50?(t.style[o]=n+"%",t.style["margin-"+o]=s*(n/-100)+"px"):(n=100-n,t.style[a]=n+"%",t.style["margin-"+a]=s*(n/-100)+"px")):void(t.style[o]=n)},i=function(e){var t=e.dataset?e.dataset.objectFit:e.getAttribute("data-object-fit"),n=e.dataset?e.dataset.objectPosition:e.getAttribute("data-object-position");t=t||"cover",n=n||"50% 50%";var i=e.parentNode;(function(e){var t=window.getComputedStyle(e,null),r=t.getPropertyValue("position"),n=t.getPropertyValue("overflow"),i=t.getPropertyValue("display");r&&"static"!==r||(e.style.position="relative"),"hidden"!==n&&(e.style.overflow="hidden"),i&&"inline"!==i||(e.style.display="block"),0===e.clientHeight&&(e.style.height="100%"),-1===e.className.indexOf("object-fit-polyfill")&&(e.className=e.className+" object-fit-polyfill")})(i),function(e){var t=window.getComputedStyle(e,null),r={"max-width":"none","max-height":"none","min-width":"0px","min-height":"0px",top:"auto",right:"auto",bottom:"auto",left:"auto","margin-top":"0px","margin-right":"0px","margin-bottom":"0px","margin-left":"0px"};for(var n in r)t.getPropertyValue(n)!==r[n]&&(e.style[n]=r[n])}(e),e.style.position="absolute",e.style.height="100%",e.style.width="auto","scale-down"===t&&(e.style.height="auto",e.clientWidth<i.clientWidth&&e.clientHeight<i.clientHeight?(r("x",e,n),r("y",e,n)):(t="contain",e.style.height="100%")),"none"===t?(e.style.width="auto",e.style.height="auto",r("x",e,n),r("y",e,n)):"cover"===t&&e.clientWidth>i.clientWidth||"contain"===t&&e.clientWidth<i.clientWidth?(e.style.top="0",e.style.marginTop="0",r("x",e,n)):"scale-down"!==t&&(e.style.width="100%",e.style.height="auto",e.style.left="0",e.style.marginLeft="0",r("y",e,n))},o=function(e){if(void 0===e)e=document.querySelectorAll("[data-object-fit]");else if(e&&e.nodeName)e=[e];else{if("object"!=(void 0===e?"undefined":n(e))||!e.length||!e[0].nodeName)return!1;e=e}for(var r=0;r<e.length;r++)if(e[r].nodeName){var o=e[r].nodeName.toLowerCase();"img"!==o||t?"video"===o&&(e[r].readyState>0?i(e[r]):e[r].addEventListener("loadedmetadata",function(){i(this)})):e[r].complete?i(e[r]):e[r].addEventListener("load",function(){i(this)})}return!0};document.addEventListener("DOMContentLoaded",function(){o()}),window.addEventListener("resize",function(){o()}),window.objectFitPolyfill=o}}()},function(e,t,r){"use strict";r(70);var n=r(69),i=r(15),o=(r(6),void 0),a=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;function c(){this.name="NoVideoInputDevicesError",this.message="No video input devices found"}function d(e){throw console.log(o.name+": Failed to find an appropriate webcam."),console.log(e),"NotFoundError"===e.name?"en"===o.lang?o.name+": Couldn't find a webcam. Please, connect webcam to your device and refresh this page.":o.name+": Веб-камера не найдена. Пожалуйста, подсоедините веб-камеру к устройству и обновите эту страничку.":"NotAllowedError"===e.name?"en"===o.lang?o.name+": Access to webcam is denied. Please, refresh this page and allow webcam access.":o.name+": Отказано в доступе к веб-камере. Пожалуйста, обновите эту страничку и разрешите доступ к веб-камере.":"NotSupportedError"===e.name?"en"===o.lang?o.name+": Server Error - Unsecure origin. Connection should be HTTPS.":o.name+": Ошибка Сервера - Небезопасное подключение. Соединение должено быть HTTPS.":"OverconstrainedError"===e.name||"undefined"!=typeof OverconstrainedError&&e instanceof OverconstrainedError?"en"===o.lang?o.name+": Couldn't find a webcam with at least 720p resolution. Please, connect a webcam with at least 720p resolution and refresh this page.":o.name+": Веб-камера с минимальным разрешением 720p не найдена. Пожалуйста, подсоедините веб-камеру 720p (или выше) и обновите эту страничку.":"SecurityError"===e.name?"en"===o.lang?o.name+": Access to webcam is denied by your browser. Please, change webcam access settings in your browser.":o.name+": Ваш браузер отказал в доступе к веб-камере. Пожалуйста, измените настройки доступа к веб-камере в Вашем браузере.":"NotReadableError"===e.name||"AbortError"===e.name?"en"===o.lang?o.name+": Webcam Error - Unable to read from webcam. Please, check your webcam.":o.name+": Ошибка веб-камеры - Невозможно прочитать данные с веб-камеры. Пожалуйста, проверьте Вашу веб-камеру.":"en"===o.lang?o.name+": Unable to access a webcam.":o.name+": Не смогли получить доступ к веб-камере."}function u(e){o.innerWrapper=document.createElement("div"),o.video=document.createElement("video"),o.imgPreview=document.createElement("img"),o.statusImageView=document.createElement("img"),o.statusTextView=new n.StatusTextView,o.retryBtn=document.createElement("button"),o.retryBtn.setAttribute("type","button"),o.drawCanvas=document.createElement("canvas"),o.docTypeSelect=document.createElement("select");var t=o,r=t.wrapper,c=t.innerWrapper,d=t.video,u=t.imgPreview,f=t.statusImageView,h=t.statusTextView,v=t.retryBtn,m=t.drawCanvas;t.docTypeSelect;r.appendChild(c),c.appendChild(d),c.appendChild(f),c.appendChild(h.getNode()),c.appendChild(v),c.appendChild(m),r.appendChild(u),c.style.cssText="width: 100%; margin-top: 10px; padding-top: 56.25%; position: relative; overflow: hidden; display: none; -webkit-box-sizing:border-box;-moz-box-sizing: border-box; box-sizing: border-box;",d.setAttribute("data-object-fit","none"),d.setAttribute("data-object-position","50% 50%"),d.setAttribute("autoplay",""),d.style.cssText="left: 0px; top: 0px; width: 100%; height: 100%; overflow: hidden; display: block; position: absolute; object-fit: none; object-position: 50% 50%;",m.style.cssText="position: absolute; margin-left: auto; margin-right: auto; left: 0; right: 0; top: 0; z-index: 10;",u.style.cssText="margin: auto; max-width: 250px; max-height: 250px; display: none;",f.style.cssText="position:absolute; left:50%; top:50%;transform: translate(-50%, -50%); display:none;",v.style.cssText="position:absolute; color: white; z-index: 20; left:50%; transform: translate(-50%, 0%);border-radius: 4px; margin-left: -1px; background-color: #555555; display: none;border: 1px solid #333333; text-align: center; text-decoration: none;",v.innerHTML=i.strings.retake,o.startOnReadyState=!1,o.started=!1,o.start=function(){if(o.started)return o.autoCapture.sessionToken;o.started=!0,o.startOnReadyState=!0,o.innerWrapper.style.display="block",o.imgPreview.style.display="none",o.retryBtn.style.display="none";try{return o.autoCapture.renewSessionToken(),o.autoCapture.start(),o.autoCapture.sessionToken}catch(e){return""}},o.startOnSameSession=function(){if(o.started)return o.autoCapture.sessionToken;o.started=!0,o.startOnReadyState=!0,o.innerWrapper.style.display="block",o.imgPreview.style.display="none",o.retryBtn.style.display="none";try{return o.autoCapture.start(),o.autoCapture.sessionToken}catch(e){return""}},o.stop=function(){if(o.started){o.started=!1,o.startOnReadyState=!1;try{o.autoCapture.stop()}catch(e){}}},o.dispose=function(){for(var t in o.stop(),d.pause(),void 0!==d.srcObject?d.removeAttribute("srcObject"):void 0!==d.mozSrcObject?d.removeAttribute("mozSrcObject"):window.URL.createObjectURL?d.removeAttribute("src"):(window.webkitURL,d.removeAttribute("src")),e.getTracks()[0].stop(),r)delete r[t];o.wrapper.innerHTML=""},o.docType=1,o.setDocType=function(e){o.docType=e,1!=e&&o.setRecognitionMode(0)},o.recognitionMode=1,o.setRecognitionMode=function(e){1==o.docType?o.recognitionMode=e:o.recognitionMode=0},o.isTranslitCheckNeeded=!1,o.setIsTranslitCheckNeeded=function(e){o.isTranslitCheckNeeded=e},o.isGlareCheckNeeded=!1,o.setIsGlareCheckNeeded=function(e){o.isGlareCheckNeeded=e},o.isAutoDocTypeMode=!1,o.setIsAutoDocTypeMode=function(e){o.isAutoDocTypeMode=e},o.recognitionWarnings=[],o.getRecognitionWarnings=function(){return o.recognitionWarnings},o.setMirrorPreviewForWebCameras=function(e){var t="left: 0px; top: 0px; width: 100%; height: 100%; overflow: hidden; display: block; position: absolute; object-fit: none; object-position: 50% 50%;";e&&!a&&(t+=" transform: scaleX(-1);"),d.style.cssText=t},v.addEventListener("click",o.startOnSameSession),d.addEventListener("loadedmetadata",function(){p(),window.addEventListener("resize",p),console.log(o.name+": Actual Video Size: "+this.videoWidth+"x"+this.videoHeight),o.innerWrapper.style.display="block",o.webCamReady()}),o.isVideoPlaying=!1,d.addEventListener("playing",function(){o.isVideoPlaying=!0}),d.addEventListener("pause",function(){o.isVideoPlaying=!1}),o.stream=e,void 0!==d.srcObject?d.srcObject=e:void 0!==d.mozSrcObject?d.mozSrcObject=e:window.URL.createObjectURL?d.src=window.URL.createObjectURL(e):window.webkitURL?d.src=window.webkitURL.createObjectURL(e):d.src=e,d.playsInline=!0;var g=e.getTracks()[0];d.addEventListener("loadstart",l);var y=!/rear|back|environment/gi.test(g.label);console.log(o.name+": WebCam name: "+g.label),y&&!s||(console.log(o.name+": Not user-facing camera - disable mirroring preview!"),d.style.transform="none")}function p(){o.adjustFrame=p;var e=o.video,t=void 0,r=e.videoHeight<1100?.7:.3;t=e.videoHeight>e.videoWidth?Math.round(e.videoWidth):Math.round(r*e.videoHeight*16/9),o.wrapper.style["max-width"]=t+"px";var n=o.wrapper.getBoundingClientRect().width;if(n<t||a){var i=o.wrapper.getBoundingClientRect().width,s=Math.round(i/16*9*o.aspectRatio/o.aspectRatio);o.innerWrapper.style.cssText+="height: "+s+"px; width: "+i+"px;",r=1,e.setAttribute("data-object-fit","cover"),e.style["object-fit"]="cover",e.videoHeight>e.videoWidth?(o.resolution.width=Math.round(e.videoWidth/16*9*o.aspectRatio),o.resolution.height=Math.round(o.resolution.width/o.aspectRatio)):(o.resolution.height=Math.round(r*e.videoHeight),o.resolution.width=Math.round(o.resolution.height*o.aspectRatio)),o.retryBtn.style.cssText+=n>800?"bottom: 20px; font-size: 26px; padding: 5px 30px;":n>500?"bottom: 12px; font-size: 18px; padding: 3px 20px;":"bottom: 7px; font-size: 10px; padding: 0px 14px;",o.statusImageView.style.cssText+="width:50px; height:50px;",o.statusTextView.updatePosition(n),o.drawCanvas.height=Math.round(n/16*9*o.aspectRatio/o.aspectRatio),o.drawCanvas.width=n,o.drawCanvas.widthOffset=(n-Math.round(n/16*9*o.aspectRatio))/2,o.drawCanvasRatio=o.resolution.width/o.drawCanvas.width}else e.setAttribute("data-object-fit","none"),e.style["object-fit"]="none",o.resolution.height=Math.round(r*e.videoHeight),o.resolution.width=Math.round(o.resolution.height*o.aspectRatio),o.retryBtn.style.cssText+=n>800?"bottom: 20px; font-size: 26px; padding: 10px 30px;":n>500?"bottom: 12px; font-size: 18px; padding: 5px 20px;":"bottom: 7px; font-size: 10px; padding: 0px 14px;",o.statusImageView.style.cssText+="width:90px; height:90px;",o.statusTextView.updatePosition(n),o.drawCanvas.width=n,o.drawCanvas.widthOffset=(n-o.resolution.width)/2,o.drawCanvas.height=o.resolution.height,o.drawCanvasRatio=1;try{o.autoCapture.updateResolution(o.resolution)}catch(e){}}function l(){var e=o.video;e.play(),e.removeEventListener("loadstart",l)}c.prototype=new Error,e.exports=function(e,t,n){if(o=e,navigator.userAgent.match(/UCBrowser/i))return Promise.reject("en"===o.lang?o.name+": Unsupported browser. Please, use latest Chrome, Firefox, Safari or Edge browser.":o.name+": Ваш браузер не поддерживается. Пожалуйста, используйте последние браузера Chrome, Firefox, Safari или Edge.");var i=r(68),a=i.browserDetails.browser,s=i.browserDetails.version;if(console.log(o.name+": Browser - "+a+" v"+s),navigator.userAgent.match(/CriOS|FxiOS/i))return Promise.reject("en"===o.lang?o.name+": On iOS devices please use latest Safari browser.":o.name+": На iOS устройствах, пожалуйста, используйте последнюю версию браузера Safari.");/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(a="safari",s=function(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}(navigator.userAgent,/AppleWebKit\/(\d+)\./,1));if("safari"===a&&s<604)return Promise.reject("en"===o.lang?o.name+": Outdated browser. Please, update your device to iOS 11 or above.":o.name+": Устаревший браузер. Пожалуйста, обновите Ваше устройство до iOS 11 или выше.");if("chrome"===a&&s<57||"firefox"===a&&s<52||"edge"===a&&s<16e3)return Promise.reject("en"===o.lang?o.name+": Outdated browser. Please, update your "+a+" to the latest version.":o.name+": Устаревший браузер. Пожалуйста, обновите Ваш  "+a+" до последней версии.");if("Not a supported browser."===a)return Promise.reject("en"===o.lang?o.name+": Unsupported browser. Please, use latest Chrome, Firefox, Safari or Edge browser.":o.name+": Ваш браузер не поддерживается. Пожалуйста, используйте последние браузера Chrome, Firefox, Safari или Edge.");var p="firefox"===a,l=void 0!==navigator.mediaDevices?navigator.mediaDevices.getSupportedConstraints():{},f={};l.facingMode&&(f.facingMode={ideal:t}),l.frameRate&&(f.frameRate={ideal:25});var h=l.facingMode||p?Promise.resolve(f):function(e,t){return new Promise(function(r,n){var i=void 0;try{i=navigator.mediaDevices.enumerateDevices()}catch(e){n(new c)}i.then(function(i){var o=i.filter(function(e){return"videoinput"===e.kind});if(o.length<1)n(new c);else{var a=t(e),s=o.filter(function(e){var t=e.label;return a.test(t)});r(function(e,t,r){return e.length>0?e[0].deviceId:1===t.length||"user"===r?t[0].deviceId:t[1].deviceId}(s,o,e))}})})}(t,n).then(function(e){return{deviceId:e}});return new Promise(function(e,t){h.then(function(t){return console.log(o.name+": Trying to find FullHD webcam..."),t.width={exact:1920},t.height={exact:1080},e(navigator.mediaDevices.getUserMedia({video:t}).then(u).catch(function(e){return console.log(o.name+": FullHD is not supported."),console.log(o.name+": Retrying with HD..."),t.width={exact:1280},t.height={exact:720},navigator.mediaDevices.getUserMedia({video:t}).then(u).catch(d)}))}).catch(function(e){t(e)})})}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i,o){if(void 0===o&&(o=5),"number"==typeof o)o={tl:o,tr:o,br:o,bl:o};else{var a={tl:0,tr:0,br:0,bl:0};for(var s in a)o[s]=o[s]||a[s]}e.beginPath(),e.moveTo(t+o.tl,r),e.lineTo(t+n-o.tr,r),e.quadraticCurveTo(t+n,r,t+n,r+o.tr),e.lineTo(t+n,r+i-o.br),e.quadraticCurveTo(t+n,r+i,t+n-o.br,r+i),e.lineTo(t+o.bl,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o.bl),e.lineTo(t,r+o.tl),e.quadraticCurveTo(t,r,t+o.tl,r),e.closePath()}},function(e,t){e.exports='<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><path style="fill:#FF3636;" d="M256,0C115.3,0,0,115.3,0,256s115.3,256,256,256s256-115.3,256-256S396.7,0,256,0z"></path><path style="fill:#F40000;" d="M512,256c0,140.7-115.3,256-256,256V0C396.7,0,512,115.3,512,256z"></path><polygon style="fill:#E7E7E7;" points="298.299,256 383.2,340.901 340.901,383.2 256,298.299 171.099,383.2 128.8,340.901 213.701,256 128.8,171.099 171.099,128.8 256,213.701 340.901,128.8 383.2,171.099 "></polygon><polygon style="fill:#D3D3D8;" points="298.299,256 383.2,340.901 340.901,383.2 256,298.299 256,213.701 340.901,128.8 383.2,171.099 "></polygon><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>'},function(e,t){e.exports='<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><path style="fill:#77DD00;" d="M256,0C115.3,0,0,115.3,0,256s115.3,256,256,256s256-115.3,256-256S396.7,0,256,0z"></path><path style="fill:#66BB00;" d="M512,256c0,140.7-115.3,256-256,256V0C396.7,0,512,115.3,512,256z"></path><polygon style="fill:#E7E7E7;" points="401.8,212.5 226,388.299 99.699,262.299 142.301,219.699 226,303.699 256,273.699 359.5,170.2 "></polygon><polygon style="fill:#D3D3D8;" points="401.8,212.5 256,358.299 256,273.699 359.5,170.2 "></polygon><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>'},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2));t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="00000000-0000-0000-0000-000000000000"},function(e,t,r){"use strict";function n(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function i(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var a=0;a<o.length;++a)e.push(o.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,c=Math.ceil(s/16),d=new Array(c),u=0;u<c;++u){for(var p=new Uint32Array(16),l=0;l<16;++l)p[l]=e[64*u+4*l]<<24|e[64*u+4*l+1]<<16|e[64*u+4*l+2]<<8|e[64*u+4*l+3];d[u]=p}d[c-1][14]=8*(e.length-1)/Math.pow(2,32),d[c-1][14]=Math.floor(d[c-1][14]),d[c-1][15]=8*(e.length-1)&4294967295;for(var f=0;f<c;++f){for(var h=new Uint32Array(80),v=0;v<16;++v)h[v]=d[f][v];for(var m=16;m<80;++m)h[m]=i(h[m-3]^h[m-8]^h[m-14]^h[m-16],1);for(var g=r[0],y=r[1],C=r[2],b=r[3],T=r[4],S=0;S<80;++S){var w=Math.floor(S/20),R=i(g,5)+n(w,y,C,b)+T+t[w]+h[S]>>>0;T=b,b=C,C=i(y,30)>>>0,y=g,g=R}r[0]=r[0]+g>>>0,r[1]=r[1]+y>>>0,r[2]=r[2]+C>>>0,r[3]=r[3]+b>>>0,r[4]=r[4]+T>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(13)),i=o(r(77));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,n.default)("v5",80,i.default);t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(14)),i=o(r(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){var o=(e=e||{}).random||(e.rng||n.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=o[a];return t}return(0,i.default)(o)}},function(e,t,r){"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function o(e,t,r,n,o,a){return i(function(e,t){return e<<t|e>>>32-t}(i(i(t,e),i(n,a)),o),r)}function a(e,t,r,n,i,a,s){return o(t&r|~t&n,e,t,i,a,s)}function s(e,t,r,n,i,a,s){return o(t&n|r&~n,e,t,i,a,s)}function c(e,t,r,n,i,a,s){return o(t^r^n,e,t,i,a,s)}function d(e,t,r,n,i,a,s){return o(r^(t|~n),e,t,i,a,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n=0;n<r;n+=8){var i=e[n>>5]>>>n%32&255,o=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;for(var r=1732584193,o=-271733879,u=-1732584194,p=271733878,l=0;l<e.length;l+=16){var f=r,h=o,v=u,m=p;r=a(r,o,u,p,e[l],7,-680876936),p=a(p,r,o,u,e[l+1],12,-389564586),u=a(u,p,r,o,e[l+2],17,606105819),o=a(o,u,p,r,e[l+3],22,-1044525330),r=a(r,o,u,p,e[l+4],7,-176418897),p=a(p,r,o,u,e[l+5],12,1200080426),u=a(u,p,r,o,e[l+6],17,-1473231341),o=a(o,u,p,r,e[l+7],22,-45705983),r=a(r,o,u,p,e[l+8],7,1770035416),p=a(p,r,o,u,e[l+9],12,-1958414417),u=a(u,p,r,o,e[l+10],17,-42063),o=a(o,u,p,r,e[l+11],22,-1990404162),r=a(r,o,u,p,e[l+12],7,1804603682),p=a(p,r,o,u,e[l+13],12,-40341101),u=a(u,p,r,o,e[l+14],17,-1502002290),o=a(o,u,p,r,e[l+15],22,1236535329),r=s(r,o,u,p,e[l+1],5,-165796510),p=s(p,r,o,u,e[l+6],9,-1069501632),u=s(u,p,r,o,e[l+11],14,643717713),o=s(o,u,p,r,e[l],20,-373897302),r=s(r,o,u,p,e[l+5],5,-701558691),p=s(p,r,o,u,e[l+10],9,38016083),u=s(u,p,r,o,e[l+15],14,-660478335),o=s(o,u,p,r,e[l+4],20,-405537848),r=s(r,o,u,p,e[l+9],5,568446438),p=s(p,r,o,u,e[l+14],9,-1019803690),u=s(u,p,r,o,e[l+3],14,-187363961),o=s(o,u,p,r,e[l+8],20,1163531501),r=s(r,o,u,p,e[l+13],5,-1444681467),p=s(p,r,o,u,e[l+2],9,-51403784),u=s(u,p,r,o,e[l+7],14,1735328473),o=s(o,u,p,r,e[l+12],20,-1926607734),r=c(r,o,u,p,e[l+5],4,-378558),p=c(p,r,o,u,e[l+8],11,-2022574463),u=c(u,p,r,o,e[l+11],16,1839030562),o=c(o,u,p,r,e[l+14],23,-35309556),r=c(r,o,u,p,e[l+1],4,-1530992060),p=c(p,r,o,u,e[l+4],11,1272893353),u=c(u,p,r,o,e[l+7],16,-155497632),o=c(o,u,p,r,e[l+10],23,-1094730640),r=c(r,o,u,p,e[l+13],4,681279174),p=c(p,r,o,u,e[l],11,-358537222),u=c(u,p,r,o,e[l+3],16,-722521979),o=c(o,u,p,r,e[l+6],23,76029189),r=c(r,o,u,p,e[l+9],4,-640364487),p=c(p,r,o,u,e[l+12],11,-421815835),u=c(u,p,r,o,e[l+15],16,530742520),o=c(o,u,p,r,e[l+2],23,-995338651),r=d(r,o,u,p,e[l],6,-198630844),p=d(p,r,o,u,e[l+7],10,1126891415),u=d(u,p,r,o,e[l+14],15,-1416354905),o=d(o,u,p,r,e[l+5],21,-57434055),r=d(r,o,u,p,e[l+12],6,1700485571),p=d(p,r,o,u,e[l+3],10,-1894986606),u=d(u,p,r,o,e[l+10],15,-1051523),o=d(o,u,p,r,e[l+1],21,-2054922799),r=d(r,o,u,p,e[l+8],6,1873313359),p=d(p,r,o,u,e[l+15],10,-30611744),u=d(u,p,r,o,e[l+6],15,-1560198380),o=d(o,u,p,r,e[l+13],21,1309151649),r=d(r,o,u,p,e[l+4],6,-145523070),p=d(p,r,o,u,e[l+11],10,-1120210379),u=d(u,p,r,o,e[l+2],15,718787259),o=d(o,u,p,r,e[l+9],21,-343485551),r=i(r,f),o=i(o,h),u=i(u,v),p=i(p,m)}return[r,o,u,p]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(n(t)),i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}(e),8*e.length))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(13)),i=o(r(80));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,n.default)("v3",48,i.default);t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i,o=s(r(14)),a=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,d=0;t.default=function(e,t,r){var s=t&&r||0,u=t||new Array(16),p=(e=e||{}).node||n,l=void 0!==e.clockseq?e.clockseq:i;if(null==p||null==l){var f=e.random||(e.rng||o.default)();null==p&&(p=n=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==l&&(l=i=16383&(f[6]<<8|f[7]))}var h=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:d+1,m=h-c+(v-d)/1e4;if(m<0&&void 0===e.clockseq&&(l=l+1&16383),(m<0||h>c)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=h,d=v,i=l;var g=(1e4*(268435455&(h+=122192928e5))+v)%4294967296;u[s++]=g>>>24&255,u[s++]=g>>>16&255,u[s++]=g>>>8&255,u[s++]=255&g;var y=h/4294967296*1e4&268435455;u[s++]=y>>>8&255,u[s++]=255&y,u[s++]=y>>>24&15|16,u[s++]=y>>>16&255,u[s++]=l>>>8|128,u[s++]=255&l;for(var C=0;C<6;++C)u[s+C]=p[C];return t||(0,a.default)(u)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(83);Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return l(n).default}});var i=r(81);Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return l(i).default}});var o=r(79);Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return l(o).default}});var a=r(78);Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return l(a).default}});var s=r(76);Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return l(s).default}});var c=r(75);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return l(c).default}});var d=r(2);Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return l(d).default}});var u=r(3);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return l(u).default}});var p=r(12);function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return l(p).default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=void 0;switch(e){case 0:t="SINGLE_IMAGE";break;case 1:t="TWO_SIDED_DOCUMENT";break;default:t="SINGLE_IMAGE"}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=void 0;switch(e){case 0:t="IN_PROGRESS";break;case 1:t="FINISHED";break;case 2:t="SUCCESS_FRONT_SIDE";break;case 3:t="BLURRY_ERROR";break;case 4:t="GLARE_ERROR";break;case 5:t="DOCUMENT_NOT_FOUND_ERROR";break;case 6:t="UNDEFINED_ERROR";break;case 7:t="FAILURE";break;case 8:t="SHOW_FRONT_FAIL";break;case 9:t="SHOW_BACK_FAIL";break;case 10:t="FIELDS_CHECK_FAIL";break;case 11:t="CROSS_SIDE_CHECK_FAIL";break;default:t="IN_PROGRESS"}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.grayScale=function(e){for(var t=e.getImageData(0,0,e.canvas.width,e.canvas.height),r=t.data,n=void 0,i=0;i<r.length;i+=4)n=.2126*r[i]+.7152*r[i+1]+.0722*r[i+2],r[i]=r[i+1]=r[i+2]=n;e.putImageData(t,0,0)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){void 0!==veridoc.gotPhotoCallback&&veridoc.gotPhotoCallback();var t=new XMLHttpRequest;t.open("POST",veridoc.url,!0),void 0!==veridoc.uploadProgressCallback&&(t.upload.onprogress=veridoc.uploadProgressCallback),t.onload=function(){if(this.status>=200&&this.status<400){var e=JSON.parse(this.response);window.veridoc.successCallback(e)}else if(400===this.status||403===this.status){var t=JSON.parse(this.response);window.veridoc.errorCallback(t)}else{window.veridoc.errorCallback({error:"Server Error!"});var r=JSON.parse(this.response);window.veridoc.errorCallback(r)}},t.send(e)}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=(u(r(88)),r(87),r(15)),o=r(6),a=u(r(86)),s=u(r(85)),c=r(5),d=r(84);function u(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.delay=400,this.video=t,this.resolution={},this.procWidth=600,this.ratioToProcWidth=1,this.streamRequestIntervalId=null,this.isStreamRequestFinished=!1,this.isStreamStopped=!0,this.currentRecognitionSide="FRONT",this.statusText="",this.kResultDisplayTime=1500,this.updateResolution=this.updateResolution.bind(this),this.renewSessionToken=this.renewSessionToken.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.streamImage=this.streamImage.bind(this),this.sessionToken=(0,d.v4)(),this.updateResolution(r)}return n(e,[{key:"renewSessionToken",value:function(){this.sessionToken=(0,d.v4)()}},{key:"updateResolution",value:function(e){this.resolution.width=e.width,this.resolution.height=e.height,this.widthOffset=Math.round((this.video.videoWidth-this.resolution.width)/2),this.heightOffset=Math.round((this.video.videoHeight-this.resolution.height)/2)}},{key:"start",value:function(){if(console.log("VeriDoc: Starting to recognize..."),this.isStreamStopped){this.video.paused&&this.video.play(),this.formData=new FormData(window.veridoc.form),this.correctCanvasIfNeeded(),this.drawOverlayBorders(),this.invalidateStatusLayout(),veridoc.statusTextView.setVisibility(!0),veridoc.statusImageView.style.display="none",this.isStreamStopped=!1;var e=setInterval(function(){veridoc.autoCapture.isStreamStopped?clearInterval(e):veridoc.isVideoPlaying&&(clearInterval(e),veridoc.autoCapture.streamImage(),veridoc.autoCapture.slowInternetTimeoutId=setTimeout(function(){console.log("VeriDoc: Slow Internet Warning!"),void 0!==veridoc.slowInternetCallback&&veridoc.slowInternetCallback()},3e3))},500)}}},{key:"stop",value:function(){if(!this.isStreamStopped){this.isStreamStopped=!0,clearTimeout(veridoc.autoCapture.slowInternetTimeoutId),veridoc.statusTextView.setText(" ");var e=veridoc.drawCanvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),console.log("VeriDoc: Stopping to recognize..")}}},{key:"streamImage",value:function(){if(!this.isStreamStopped){this.streamRequestIntervalId=setTimeout(function(){veridoc.autoCapture.streamRequestIntervalId=null,veridoc.autoCapture.isStreamRequestFinished&&(veridoc.autoCapture.isStreamRequestFinished=!1,veridoc.autoCapture.streamImage())},veridoc.autoCapture.delay);var e=document.createElement("canvas");e.width=this.resolution.width,e.height=this.resolution.height,e.getContext("2d").drawImage(this.video,this.widthOffset,this.heightOffset,this.resolution.width,this.resolution.height,0,0,this.resolution.width,this.resolution.height);var t=document.createElement("canvas"),r=t.getContext("2d");this.ratioToProcWidth=this.procWidth/e.width,t.height=e.height*this.ratioToProcWidth,t.width=this.procWidth,r.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height);for(var n=t.toDataURL("image/jpeg"),i=atob(n.split(",")[1]),o=[],a=0;a<i.length;a+=1)o.push(i.charCodeAt(a));var s=new Blob([new Uint8Array(o)],{type:"image/jpeg"}),c=new FormData;c.append("image",s,"upload.jpeg"),c.append("doc_type",veridoc.docType),c.append("session_token",this.sessionToken),c.append("recognition_mode",veridoc.recognitionMode),c.append("translit_check",veridoc.isTranslitCheckNeeded),c.append("glare_check",veridoc.isGlareCheckNeeded),c.append("auto_doc_type",veridoc.isAutoDocTypeMode);var d=new XMLHttpRequest;d.open("POST",veridoc.url,!0),d.setRequestHeader("Apikey",veridoc.apiKey),d.setRequestHeader("session-token",this.sessionToken),d.onload=function(){clearTimeout(veridoc.autoCapture.slowInternetTimeoutId),veridoc.autoCapture.isStreamRequestFinished=!0,this.status>=200&&this.status<400?veridoc.autoCapture.handleResult(JSON.parse(this.response)):console.log("Server Error!"),null==veridoc.autoCapture.streamRequestIntervalId&&(veridoc.autoCapture.isStreamRequestFinished=!1,veridoc.autoCapture.streamImage())}.bind(d),d.send(c)}}},{key:"setImageDrawable",value:function(e){var t=r(74),n=r(73),i=veridoc.drawCanvas.getContext("2d");i.fillStyle="#424243b5",i.fillRect(0,0,i.canvas.width,i.canvas.height),veridoc.statusImageView.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e?t:n)}},{key:"handleResult",value:function(e){var t=this,r=e.recognitionStatus,n=e.recognitionResults,s=e.fieldsWithErrors,c=e.recognitionWarnings;this.drawOverlayBorders(e.regions),"FINISHED"===(0,a.default)(r)||"CROSS_SIDE_CHECK_FAIL"===(0,a.default)(r)?this.currentRecognitionSide="FRONT":"SUCCESS_FRONT_SIDE"===(0,a.default)(r)&&(this.currentRecognitionSide="BACK"),"FINISHED"===(0,a.default)(r)?this.statusText=i.strings.recognition_succeeded:"BLURRY_ERROR"===(0,a.default)(r)?this.statusText=i.strings.blurry_error:"GLARE_ERROR"===(0,a.default)(r)?this.statusText=i.strings.glare_error:"DOCUMENT_NOT_FOUND_ERROR"===(0,a.default)(r)?this.statusText=i.strings.document_not_found_error:"UNDEFINED_ERROR"===(0,a.default)(r)?this.statusText=i.strings.undefined_error:"FAILURE"===(0,a.default)(r)?(this.statusText=i.strings.recognition_error_repeat,s.hasOwnProperty("iin")&&"empty_field"==s.iin&&(this.statusText=i.strings.id_has_no_iin)):"SHOW_FRONT_FAIL"===(0,a.default)(r)?this.statusText=i.strings.error_show_front:"SHOW_BACK_FAIL"===(0,a.default)(r)?this.statusText=i.strings.error_show_back:"FIELDS_CHECK_FAIL"===(0,a.default)(r)?this.statusText=i.strings.recognition_error_repeat:"CROSS_SIDE_CHECK_FAIL"===(0,a.default)(r)&&(this.statusText=i.strings.error_two_side_check),"IN_PROGRESS"!=(0,a.default)(r)&&("vibrate"in window.navigator&&window.navigator.vibrate(100),veridoc.recognitionWarnings=[],c.forEach(function(e,t){veridoc.recognitionWarnings.push((0,o.getRecognitionWarning)(e))}),this.stop(),this.startResultEffect(r),"FINISHED"===(0,a.default)(r)||"SUCCESS_FRONT_SIDE"===(0,a.default)(r)?setTimeout(function(){t.stopResultEffect(),"FINISHED"===(0,a.default)(r)?(veridoc.stop(),veridoc.successCallback(n)):t.start()},this.kResultDisplayTime):(veridoc.stop(),veridoc.errorCallback(n)))}},{key:"startResultEffect",value:function(e){"FINISHED"===(0,a.default)(e)||"SUCCESS_FRONT_SIDE"===(0,a.default)(e)?(this.setImageDrawable(!0),veridoc.statusTextView.setVisibility(!1)):(this.setImageDrawable(!1),veridoc.statusTextView.setText(this.statusText),veridoc.retryBtn.style.display="block"),veridoc.statusImageView.style.display="block";var t=veridoc.drawCanvas.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height),this.video.pause()}},{key:"stopResultEffect",value:function(){veridoc.statusImageView.style.display="none",veridoc.retryBtn.style.display="none",this.invalidateStatusLayout(),veridoc.statusTextView.setVisibility(!1)}},{key:"invalidateStatusLayout",value:function(){if("TWO_SIDED_DOCUMENT"===(0,s.default)(veridoc.recognitionMode))veridoc.isAutoDocTypeMode?this.statusText="FRONT"===this.currentRecognitionSide?i.strings.show_front_doc:i.strings.show_back_doc:this.statusText="FRONT"===this.currentRecognitionSide?i.strings.show_front_id:i.strings.show_back_id;else{var e=i.strings.document;"id"===(0,c.getDocTypeString)(veridoc.docType)?e=i.strings.identity_document:"mrz"===(0,c.getDocTypeString)(veridoc.docType)?e=i.strings.mrz_document:"sim"===(0,c.getDocTypeString)(veridoc.docType)||"sim2"===(0,c.getDocTypeString)(veridoc.docType)?e=i.strings.simcard:"passport"===(0,c.getDocTypeString)(veridoc.docType)&&(e=i.strings.passport),veridoc.isAutoDocTypeMode&&(e=i.strings.document),this.statusText=i.strings.point_camera+" <b>"+e+"</b>"}veridoc.statusTextView.setText(this.statusText)}},{key:"showPreview",value:function(){var e=this.video.videoWidth,t=this.video.videoHeight,r=document.createElement("canvas");r.width=this.resolution.width,r.height=this.resolution.height,r.getContext("2d").drawImage(this.video,-this.widthOffset,-this.heightOffset,e,t);var n=r.toDataURL("image/jpeg");veridoc.innerWrapper.style.display="none",veridoc.imgPreview.src=n,veridoc.imgPreview.style.display="block"}},{key:"drawDocBounds",value:function(e){for(var t=0;t<e.length;t+=1){var r=this.adjustDocBoundCoordinates(e[t]),n=veridoc.drawCanvas.getContext("2d");n.fillStyle="rgba(255, 255, 255, 0.6)",n.beginPath(),n.moveTo(r.tl.x,r.tl.y),n.lineTo(r.tr.x,r.tr.y),n.lineTo(r.br.x,r.br.y),n.lineTo(r.bl.x,r.bl.y),n.closePath(),n.fill()}}},{key:"adjustDocBoundCoordinates",value:function(e){var t=e;if(1!==veridoc.drawCanvasRatio&&(t.tl.x=Math.round(t.tl.x/veridoc.drawCanvasRatio),t.tr.x=Math.round(t.tr.x/veridoc.drawCanvasRatio),t.br.x=Math.round(t.br.x/veridoc.drawCanvasRatio),t.bl.x=Math.round(t.bl.x/veridoc.drawCanvasRatio),t.tl.y=Math.round(t.tl.y/veridoc.drawCanvasRatio),t.tr.y=Math.round(t.tr.y/veridoc.drawCanvasRatio),t.br.y=Math.round(t.br.y/veridoc.drawCanvasRatio),t.bl.y=Math.round(t.bl.y/veridoc.drawCanvasRatio)),t.tl.x=Math.round(t.tl.x/this.ratioToProcWidth),t.tr.x=Math.round(t.tr.x/this.ratioToProcWidth),t.br.x=Math.round(t.br.x/this.ratioToProcWidth),t.bl.x=Math.round(t.bl.x/this.ratioToProcWidth),t.tl.y=Math.round(t.tl.y/this.ratioToProcWidth),t.tr.y=Math.round(t.tr.y/this.ratioToProcWidth),t.br.y=Math.round(t.br.y/this.ratioToProcWidth),t.bl.y=Math.round(t.bl.y/this.ratioToProcWidth),"scaleX(-1)"===this.video.style.transform){var r=veridoc.drawCanvas.width;t.tl.x=r-t.tl.x,t.tr.x=r-t.tr.x,t.br.x=r-t.br.x,t.bl.x=r-t.bl.x}return t}},{key:"drawOverlayBorders",value:function(e){var t=r(72),n=veridoc.drawCanvas.getContext("2d");n.clearRect(0,0,n.canvas.width,n.canvas.height);var i=Math.round(n.canvas.height/25),o=Math.round(i*veridoc.aspectRatio)+veridoc.drawCanvas.widthOffset;n.globalCompositeOperation="destination-over",n.fillStyle="#424243b5",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.globalCompositeOperation="destination-out",n.fillStyle="black",n.lineWidth=3,n.strokeStyle=e?"#7eff73":"white",t(n,o,i,n.canvas.width-2*o,n.canvas.height-2*i,20),n.fill(),n.globalCompositeOperation="source-over",n.stroke()}},{key:"drawOverlayCorners",value:function(){var e=veridoc.drawCanvas.getContext("2d"),t=Math.round(e.canvas.height/25),r=Math.round(t*veridoc.aspectRatio),n=Math.round(.5*t),i=Math.round(2*t);e.clearRect(0,0,e.canvas.width,e.canvas.height),e.strokeStyle="#FFFF00",e.lineWidth=Math.round(.3*t),e.beginPath(),e.moveTo(r+n,t),e.lineTo(r+n+i,t),e.stroke(),e.beginPath(),e.moveTo(r,t+n),e.lineTo(r,t+n+i),e.stroke(),e.beginPath(),e.arc(r+n,t+n,n,Math.PI,1.5*Math.PI),e.stroke(),e.beginPath(),e.moveTo(e.canvas.width-r-n,t),e.lineTo(e.canvas.width-r-n-i,t),e.stroke(),e.beginPath(),e.moveTo(e.canvas.width-r,t+n),e.lineTo(e.canvas.width-r,t+n+i),e.stroke(),e.beginPath(),e.arc(e.canvas.width-r-n,t+n,n,1.5*Math.PI,2*Math.PI),e.stroke(),e.beginPath(),e.moveTo(e.canvas.width-r-n,e.canvas.height-t),e.lineTo(e.canvas.width-r-n-i,e.canvas.height-t),e.stroke(),e.beginPath(),e.moveTo(e.canvas.width-r,e.canvas.height-t-n),e.lineTo(e.canvas.width-r,e.canvas.height-t-n-i),e.stroke(),e.beginPath(),e.arc(e.canvas.width-r-n,e.canvas.height-t-n,n,0,Math.PI/2),e.stroke(),e.beginPath(),e.moveTo(r+n,e.canvas.height-t),e.lineTo(r+n+i,e.canvas.height-t),e.stroke(),e.beginPath(),e.moveTo(r,e.canvas.height-t-n),e.lineTo(r,e.canvas.height-t-n-i),e.stroke(),e.beginPath(),e.arc(r+n,e.canvas.height-t-n,n,Math.PI/2,Math.PI),e.stroke()}},{key:"correctCanvasIfNeeded",value:function(){0===veridoc.drawCanvas.width&&veridoc.adjustFrame()}}]),e}();e.exports=p},function(e,t,r){"use strict";var n=r(6);window.RecognitionWarning=n.RecognitionWarning,function(e){void 0===e.veridocObject&&(e.veridoc=function(){var e={init:function(e,t,n,i,o,a,s){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"ru";return this.name="VeriDoc",this.url=e,this.apiKey=t,this.successCallback=n,this.errorCallback=i,this.gotPhotoCallback=o,this.uploadProgressCallback=a,this.slowInternetCallback=s,this.lang=c,this.wrapper=document.getElementById("id_veridoc"),this.wrapper?(this.form=document.createElement("form"),this.form.setAttribute("method","post"),this.form.setAttribute("enctype","multipart/form-data"),this.form.setAttribute("multiple",""),this.wrapper.appendChild(this.form),this.aspectRatio=1.586,this.resolution={},this.webCamReady=function(){var e=r(89);this.autoCapture=new e(this.video,this.resolution),this.startOnReadyState&&this.autoCapture.start()},r(71)(this,"environment",function(e){return"environment"===e?/rear|back|environment/gi:/front|user|face/gi})):(console.log('VeriDoc: Couldn\'t find element with id="id_veridoc"!'),!1)}};return e}())}(window)}]);